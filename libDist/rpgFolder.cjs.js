"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const a=require("@sigureya/rpgtypes"),tt=t=>[null,...t],m=(t,e,n)=>e.endsWith(`${t.sep}${a.FOLDER_DATA}`)?t.resolve(e,n):t.resolve(e,a.FOLDER_DATA,n),et=(t,e)=>{if(Array.isArray(t))return t.filter(n=>e(n));throw new Error("Invalid data format")},c=async(t,e,n,r=2)=>{const s=tt(n);return t.writeFile(e,JSON.stringify(s,null,r),"utf-8")},l=async(t,e,n)=>{const r=await t.readFile(e,"utf-8"),s=JSON.parse(r);return et(s,n)},R=(t,e)=>m(t,e,a.FILENAME_ACTORS),C=(t,e,n,r,s=2)=>{const o=R(t,n);return c(e,o,r,s)},y=async(t,e,n)=>{const r=R(t,n);return l(e,r,a.isDataActor)},A=(t,e)=>m(t,e,a.FILENAME_ARMORS),z=(t,e,n,r,s=2)=>{const o=A(t,n);return c(e,o,r,s)},g=async(t,e,n)=>{const r=A(t,n);return l(e,r,a.isDataArmor)},d=(t,e)=>m(t,e,a.FILENAME_CLASSES),v=(t,e,n,r,s=2)=>{const o=d(t,n);return c(e,o,r,s)},G=async(t,e,n)=>{const r=d(t,n);return l(e,r,a.isDataClass)},F=(t,e)=>m(t,e,a.FILENAME_ENEMIES),L=(t,e,n,r,s=2)=>{const o=F(t,n);return c(e,o,r,s)},N=async(t,e,n)=>{const r=F(t,n);return l(e,r,a.isDataEnemy)},S=(t,e)=>m(t,e,a.FILENAME_ITEMS),k=(t,e,n,r,s=2)=>{const o=S(t,n);return c(e,o,r,s)},B=async(t,e,n)=>{const r=S(t,n);return l(e,r,a.isDataItem)},O=(t,e)=>m(t,e,a.FILENAME_SKILLS),f=(t,e,n,r,s=2)=>{const o=O(t,n);return c(e,o,r,s)},W=async(t,e,n)=>{const r=O(t,n);return l(e,r,a.isDataSkill)},T=(t,e)=>m(t,e,a.FILENAME_STATES),U=(t,e,n,r,s=2)=>{const o=T(t,n);return c(e,o,r,s)},V=async(t,e,n)=>{const r=T(t,n);return l(e,r,a.isDataState)},M=(t,e)=>m(t,e,a.FILENAME_WEAPONS),$=(t,e,n,r,s=2)=>{const o=M(t,n);return c(e,o,r,s)},j=async(t,e,n)=>{const r=M(t,n);return l(e,r,a.isDataWeapon)},nt=t=>typeof t=="object"&&t!==null&&"id"in t&&typeof t.id=="number",h=(t,e)=>m(t,e,a.FILENAME_TROOPS),rt=(t,e,n,r,s=2)=>{const o=h(t,n);return c(e,o,r,s)},x=async(t,e,n)=>{const r=h(t,n);return l(e,r,nt)},at=t=>!!t&&typeof t=="object"&&"id"in t,P=(t,e)=>m(t,e,a.FILENAME_COMMON_EVENTS),st=(t,e,n,r,s=2)=>{const o=P(t,n);return c(e,o,r,s)},K=async(t,e,n)=>{const r=P(t,n);return l(e,r,at)},w=(t,e)=>m(t,e,a.FILENAME_MAP_INFOS),ot=(t,e,n,r,s=2)=>{const o=w(t,n);return c(e,o,r,s)},H=async(t,e,n)=>{const r=w(t,n);return l(e,r,a.isDataMapInfo)},J=t=>t.startsWith("Map")&&t.endsWith(".json"),it=async(t,e)=>(await t.readdir(e,{withFileTypes:!0})).filter(n=>n.isFile()&&J(n.name)),mt=t=>`Map${String(t).padStart(3,"0")}.json`,Y=(t,e,n)=>{const r=mt(n);return{filePath:t.resolve(e,r),fileName:r}},ct=t=>a.makeMapData(t),q=async(t,e,n,r)=>{const{filePath:s,fileName:o}=Y(e,n,r.id);try{const u=await t.readFile(s,"utf-8"),I=ct(JSON.parse(u));return{filename:o,map:I,editingName:r.name}}catch{return{filename:o,editingName:r.name,map:void 0}}},lt=async(t,e,n,r,s)=>(s??await H(e,t,n)).filter(u=>!!u&&a.isDataMapInfo(u)).map(async u=>{const I=await q(t,e,n,u);return r(I)}),ut=async(t,e,n,r)=>({actor:r.actor?r.actor(await y(e,t,n),a.SRC_DATA_ACTOR):void 0,armor:r.armor?r.armor(await g(e,t,n),a.SRC_DATA_ARMOR):void 0,enemy:r.enemy?r.enemy(await N(e,t,n),a.SRC_DATA_ENEMY):void 0,class:r.class?r.class(await G(e,t,n),a.SRC_DATA_CLASS):void 0,item:r.item?r.item(await B(e,t,n),a.SRC_DATA_ITEMS):void 0,skill:r.skill?r.skill(await W(e,t,n),a.SRC_DATA_SKILL):void 0,state:r.state?r.state(await V(e,t,n),a.SRC_DATA_STATE):void 0,weapon:r.weapon?r.weapon(await j(e,t,n),a.SRC_DATA_WEAPON):void 0,troop:r.troop?r.troop(await x(e,t,n),a.SRC_DATA_TROOP):void 0,commonEvent:r.commonEvent?r.commonEvent(await K(e,t,n),a.SRC_DATA_COMMON_EVNET):void 0}),D=t=>{try{return t()}catch{return Promise.resolve()}},Dt=async(t,e,n,r)=>Promise.all([D(()=>C(e,t,n,r.actors)),D(()=>L(e,t,n,r.enemies)),D(()=>z(e,t,n,r.armors)),D(()=>$(e,t,n,r.weapons)),D(()=>v(e,t,n,r.classes)),D(()=>k(e,t,n,r.items)),D(()=>f(e,t,n,r.skills)),D(()=>U(e,t,n,r.states))]),E=(t,e,n,r)=>{const s=t.normalize(e);return s.endsWith(`${t.sep}${n}`)?t.resolve(s,r):s.endsWith(`${t.sep}${n}${t.sep}${r}`)?s:t.resolve(e,n,r)},Et=t=>!t.includes("."),It=(t,e,n,r,s,o)=>{if(!Et(s))throw new Error(`Invalid file path: ${s}`);const u=E(t,e,n,r);return t.join(u,`${s}.${o}`)},i=(t,e,n,r)=>It(t,e,a.FOLDER_IMG,n,r,"png"),_t=(t,e,n)=>i(t,e,a.FOLDER_AUDIO_BGM,n),Rt=(t,e,n)=>i(t,e,a.FOLDER_AUDIO_BGS,n),At=(t,e,n)=>i(t,e,a.FOLDER_AUDIO_ME,n),dt=(t,e,n)=>i(t,e,a.FOLDER_AUDIO_SE,n),Ft=(t,e,n)=>i(t,e,a.FOLDER_IMG_FACES,n),St=(t,e,n)=>i(t,e,a.FOLDER_IMG_PICTURES,n),Ot=(t,e,n)=>i(t,e,a.FOLDER_IMG_BATTLEBACK1,n),Tt=(t,e,n)=>i(t,e,a.FOLDER_IMG_BATTLEBACK2,n),Mt=(t,e,n)=>i(t,e,a.FOLDER_IMG_CHACTERS,n),ht=(t,e,n)=>i(t,e,a.FOLDER_IMG_ENEMIES,n),Pt=(t,e,n)=>i(t,e,a.FOLDER_IMG_PARALLACES,n),wt=(t,e,n)=>i(t,e,a.FOLDER_IMG_SV_ACTORS,n),pt=(t,e,n)=>i(t,e,a.FOLDER_IMG_SV_ENEMIES,n),Ct=(t,e,n)=>i(t,e,a.FOLDER_IMG_SYSTEM,n),yt=(t,e,n)=>i(t,e,a.FOLDER_IMG_TILESETS,n),zt=(t,e,n)=>i(t,e,a.FOLDER_IMG_TITLES1,n),gt=(t,e,n)=>i(t,e,a.FOLDER_IMG_TITLES2,n),vt=[a.FOLDER_AUDIO_BGM,a.FOLDER_AUDIO_BGS,a.FOLDER_AUDIO_ME,a.FOLDER_AUDIO_SE],Gt=[a.FOLDER_IMG_FACES,a.FOLDER_IMG_PICTURES,a.FOLDER_IMG_BATTLEBACK1,a.FOLDER_IMG_BATTLEBACK2,a.FOLDER_IMG_CHACTERS,a.FOLDER_IMG_ENEMIES,a.FOLDER_IMG_PARALLACES,a.FOLDER_IMG_SV_ACTORS,a.FOLDER_IMG_SV_ENEMIES,a.FOLDER_IMG_SYSTEM,a.FOLDER_IMG_TILESETS,a.FOLDER_IMG_TITLES1,a.FOLDER_IMG_TITLES2],p=(t,e,n,r,s)=>{const o=E(t,n,r,s);return e.mkdir(o,{recursive:!0})},Lt=(t,e,n)=>Gt.map(r=>p(t,e,n,a.FOLDER_IMG,r)),Nt=(t,e,n)=>vt.map(r=>p(t,e,n,a.FOLDER_IMG,r)),kt=(t,e,n)=>[p(t,e,n,a.FOLDER_DATA,"")],Bt=t=>t===""?!0:!(t.endsWith("/")||Wt(t)||Ut(t)),ft=["con","prn","aux","nul","com1","com2","com3","com4","com5","com6","com7","com8","com9","lpt1","lpt2","lpt3","lpt4","lpt5","lpt6","lpt7","lpt8","lpt9"],Wt=t=>/[.#\\]/.test(t),Ut=t=>t.split("/").some(n=>ft.includes(n.toLowerCase())),Vt=async(t,e,n,r)=>{const s=E(t,n,a.FOLDER_IMG,r);return(await e.readdir(s,{withFileTypes:!0})).filter(Z)},_=(t,e)=>t.name.endsWith(e),Q=t=>_(t,".ogg")||_(t,".m4a"),X=t=>_(t,".png"),Z=t=>t.isFile()&&X(t),b=t=>t.isFile()&&Q(t),$t=async(t,e,n,r)=>{const s=E(t,n,a.FOLDER_AUDIO,r);return(await e.readdir(s,{withFileTypes:!0})).filter(b)};exports.buildBattleback1Path=Ot;exports.buildBattleback2Path=Tt;exports.buildBgmPath=_t;exports.buildBgsPath=Rt;exports.buildCharactersImagePath=Mt;exports.buildEnemyImagesPath=ht;exports.buildFaceImagesPath=Ft;exports.buildMePath=At;exports.buildParallacesPath=Pt;exports.buildPicturesPath=St;exports.buildSePath=dt;exports.buildSideVewEnemiesPath=pt;exports.buildSideViewActorsPath=wt;exports.buildSystemImagePath=Ct;exports.buildTilesetImagesPath=yt;exports.buildTitle1ImagesPath=zt;exports.buildTitle2ImagesPath=gt;exports.dispatchHandlers=ut;exports.ensureActorDataPath=R;exports.ensureArmorDataPath=A;exports.ensureClassDataPath=d;exports.ensureCommonEventDataPath=P;exports.ensureEnemyDataPath=F;exports.ensureItemDataPath=S;exports.ensureMapInfoDataPath=w;exports.ensureSkillDataPath=O;exports.ensureStateDataPath=T;exports.ensureTroopDataPath=h;exports.ensureWeaponDataPath=M;exports.isAudioDirent=b;exports.isAudioFileExtension=Q;exports.isImageDirent=Z;exports.isImageFileExtension=X;exports.isMapFileName=J;exports.isValidAssetPath=Bt;exports.listupAudioFiles=$t;exports.listupImageFiles=Vt;exports.listupMapFiles=it;exports.makeAudioFolders=Nt;exports.makeDataFoldes=kt;exports.makeImageFolders=Lt;exports.mappingAllMapFiles=lt;exports.readMapFileFromInfo=q;exports.readRmmzActorData=y;exports.readRmmzArmorData=g;exports.readRmmzClassData=G;exports.readRmmzCommonEventData=K;exports.readRmmzEnemyData=N;exports.readRmmzItemData=B;exports.readRmmzMapInfoData=H;exports.readRmmzSkillData=W;exports.readRmmzStateData=V;exports.readRmmzTroopData=x;exports.readRmmzWeaponData=j;exports.resolveMapFilePath=Y;exports.writeDataFiles=Dt;exports.writeRmmzActorData=C;exports.writeRmmzArmorData=z;exports.writeRmmzClassData=v;exports.writeRmmzCommonEventData=st;exports.writeRmmzEnemyData=L;exports.writeRmmzItemData=k;exports.writeRmmzMapInfoData=ot;exports.writeRmmzSkillData=f;exports.writeRmmzStateData=U;exports.writeRmmzTroopData=rt;exports.writeRmmzWeaponData=$;
//# sourceMappingURL=rpgFolder.cjs.js.map
