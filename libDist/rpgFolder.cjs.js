"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const r=require("@sigureya/rpgtypes"),et=t=>[null,...t],m=(t,e,n)=>e.endsWith(`${t.sep}${r.FOLDER_DATA}`)?t.resolve(e,n):t.resolve(e,r.FOLDER_DATA,n),nt=(t,e)=>{if(Array.isArray(t))return t.filter(n=>e(n));throw new Error("Invalid data format")},c=async(t,e,n,a=2)=>{const s=et(n);return t.writeFile(e,JSON.stringify(s,null,a),"utf-8")},u=async(t,e,n)=>{const a=await t.readFile(e,"utf-8"),s=JSON.parse(a);return nt(s,n)},_=(t,e)=>m(t,e,r.FILENAME_ACTORS),z=(t,e,n,a,s=2)=>{const o=_(t,n);return c(e,o,a,s)},C=async(t,e,n)=>{const a=_(t,n);return u(e,a,r.isDataActor)},d=(t,e)=>m(t,e,r.FILENAME_ARMORS),g=(t,e,n,a,s=2)=>{const o=d(t,n);return c(e,o,a,s)},v=async(t,e,n)=>{const a=d(t,n);return u(e,a,r.isDataArmor)},A=(t,e)=>m(t,e,r.FILENAME_CLASSES),L=(t,e,n,a,s=2)=>{const o=A(t,n);return c(e,o,a,s)},G=async(t,e,n)=>{const a=A(t,n);return u(e,a,r.isDataClass)},S=(t,e)=>m(t,e,r.FILENAME_ENEMIES),N=(t,e,n,a,s=2)=>{const o=S(t,n);return c(e,o,a,s)},k=async(t,e,n)=>{const a=S(t,n);return u(e,a,r.isDataEnemy)},F=(t,e)=>m(t,e,r.FILENAME_ITEMS),f=(t,e,n,a,s=2)=>{const o=F(t,n);return c(e,o,a,s)},B=async(t,e,n)=>{const a=F(t,n);return u(e,a,r.isDataItem)},O=(t,e)=>m(t,e,r.FILENAME_SKILLS),W=(t,e,n,a,s=2)=>{const o=O(t,n);return c(e,o,a,s)},$=async(t,e,n)=>{const a=O(t,n);return u(e,a,r.isDataSkill)},M=(t,e)=>m(t,e,r.FILENAME_STATES),U=(t,e,n,a,s=2)=>{const o=M(t,n);return c(e,o,a,s)},V=async(t,e,n)=>{const a=M(t,n);return u(e,a,r.isDataState)},T=(t,e)=>m(t,e,r.FILENAME_WEAPONS),x=(t,e,n,a,s=2)=>{const o=T(t,n);return c(e,o,a,s)},j=async(t,e,n)=>{const a=T(t,n);return u(e,a,r.isDataWeapon)},at=t=>typeof t=="object"&&t!==null&&"id"in t&&typeof t.id=="number",h=(t,e)=>m(t,e,r.FILENAME_TROOPS),rt=(t,e,n,a,s=2)=>{const o=h(t,n);return c(e,o,a,s)},K=async(t,e,n)=>{const a=h(t,n);return u(e,a,at)},st=t=>!!t&&typeof t=="object"&&"id"in t,w=(t,e)=>m(t,e,r.FILENAME_COMMON_EVENTS),ot=(t,e,n,a,s=2)=>{const o=w(t,n);return c(e,o,a,s)},J=async(t,e,n)=>{const a=w(t,n);return u(e,a,st)},P=(t,e)=>m(t,e,r.FILENAME_MAP_INFOS),it=(t,e,n,a,s=2)=>{const o=P(t,n);return c(e,o,a,s)},H=async(t,e,n)=>{const a=P(t,n);return u(e,a,r.isDataMapInfo)},Y=t=>t.startsWith("Map")&&t.endsWith(".json"),mt=async(t,e)=>(await t.readdir(e,{withFileTypes:!0})).filter(n=>n.isFile()&&Y(n.name)),ct=t=>`Map${String(t).padStart(3,"0")}.json`,q=(t,e,n)=>{const a=ct(n);return{filePath:t.resolve(e,a),fileName:a}},ut=t=>r.makeMapData(t),Q=async(t,e,n,a)=>{const{filePath:s,fileName:o}=q(e,n,a.id);try{const l=await t.readFile(s,"utf-8"),I=ut(JSON.parse(l));return{filename:o,map:I,editingName:a.name}}catch{return{filename:o,editingName:a.name,map:void 0}}},lt=async(t,e,n,a,s)=>(s??await H(e,t,n)).filter(l=>!!l&&r.isDataMapInfo(l)).map(async l=>{const I=await Q(t,e,n,l);return a(I)}),Dt=t=>!!t,y=(t,e)=>m(t,e,r.FILENAME_SYSTEM),Et=(t,e,n,a,s=2)=>{const o=y(t,n),l=JSON.stringify(a,null,s);return e.writeFile(o,l,"utf8")},It=async(t,e,n)=>{const a=y(t,n),s=await e.readFile(a,"utf8"),o=JSON.parse(s);if(!Dt(o))throw new Error(`Invalid system data: ${a}`);return o},Rt=async(t,e,n,a)=>({actor:a.actor?a.actor(await C(e,t,n),r.SRC_DATA_ACTOR):void 0,armor:a.armor?a.armor(await v(e,t,n),r.SRC_DATA_ARMOR):void 0,enemy:a.enemy?a.enemy(await k(e,t,n),r.SRC_DATA_ENEMY):void 0,class:a.class?a.class(await G(e,t,n),r.SRC_DATA_CLASS):void 0,item:a.item?a.item(await B(e,t,n),r.SRC_DATA_ITEMS):void 0,skill:a.skill?a.skill(await $(e,t,n),r.SRC_DATA_SKILL):void 0,state:a.state?a.state(await V(e,t,n),r.SRC_DATA_STATE):void 0,weapon:a.weapon?a.weapon(await j(e,t,n),r.SRC_DATA_WEAPON):void 0,troop:a.troop?a.troop(await K(e,t,n),r.SRC_DATA_TROOP):void 0,commonEvent:a.commonEvent?a.commonEvent(await J(e,t,n),r.SRC_DATA_COMMON_EVNET):void 0}),D=t=>{try{return t()}catch{return Promise.resolve()}},_t=async(t,e,n,a)=>Promise.all([D(()=>z(e,t,n,a.actors)),D(()=>N(e,t,n,a.enemies)),D(()=>g(e,t,n,a.armors)),D(()=>x(e,t,n,a.weapons)),D(()=>L(e,t,n,a.classes)),D(()=>f(e,t,n,a.items)),D(()=>W(e,t,n,a.skills)),D(()=>U(e,t,n,a.states))]),E=(t,e,n,a)=>{const s=t.normalize(e);return s.endsWith(`${t.sep}${n}`)?t.resolve(s,a):s.endsWith(`${t.sep}${n}${t.sep}${a}`)?s:t.resolve(e,n,a)},dt=t=>!t.includes("."),At=(t,e,n,a,s,o)=>{if(!dt(s))throw new Error(`Invalid file path: ${s}`);const l=E(t,e,n,a);return t.join(l,`${s}.${o}`)},i=(t,e,n,a)=>At(t,e,r.FOLDER_IMG,n,a,"png"),St=(t,e,n)=>i(t,e,r.FOLDER_AUDIO_BGM,n),Ft=(t,e,n)=>i(t,e,r.FOLDER_AUDIO_BGS,n),Ot=(t,e,n)=>i(t,e,r.FOLDER_AUDIO_ME,n),Mt=(t,e,n)=>i(t,e,r.FOLDER_AUDIO_SE,n),Tt=(t,e,n)=>i(t,e,r.FOLDER_IMG_FACES,n),ht=(t,e,n)=>i(t,e,r.FOLDER_IMG_PICTURES,n),wt=(t,e,n)=>i(t,e,r.FOLDER_IMG_BATTLEBACK1,n),Pt=(t,e,n)=>i(t,e,r.FOLDER_IMG_BATTLEBACK2,n),yt=(t,e,n)=>i(t,e,r.FOLDER_IMG_CHACTERS,n),pt=(t,e,n)=>i(t,e,r.FOLDER_IMG_ENEMIES,n),zt=(t,e,n)=>i(t,e,r.FOLDER_IMG_PARALLACES,n),Ct=(t,e,n)=>i(t,e,r.FOLDER_IMG_SV_ACTORS,n),gt=(t,e,n)=>i(t,e,r.FOLDER_IMG_SV_ENEMIES,n),vt=(t,e,n)=>i(t,e,r.FOLDER_IMG_SYSTEM,n),Lt=(t,e,n)=>i(t,e,r.FOLDER_IMG_TILESETS,n),Gt=(t,e,n)=>i(t,e,r.FOLDER_IMG_TITLES1,n),Nt=(t,e,n)=>i(t,e,r.FOLDER_IMG_TITLES2,n),kt=[r.FOLDER_AUDIO_BGM,r.FOLDER_AUDIO_BGS,r.FOLDER_AUDIO_ME,r.FOLDER_AUDIO_SE],ft=[r.FOLDER_IMG_FACES,r.FOLDER_IMG_PICTURES,r.FOLDER_IMG_BATTLEBACK1,r.FOLDER_IMG_BATTLEBACK2,r.FOLDER_IMG_CHACTERS,r.FOLDER_IMG_ENEMIES,r.FOLDER_IMG_PARALLACES,r.FOLDER_IMG_SV_ACTORS,r.FOLDER_IMG_SV_ENEMIES,r.FOLDER_IMG_SYSTEM,r.FOLDER_IMG_TILESETS,r.FOLDER_IMG_TITLES1,r.FOLDER_IMG_TITLES2],p=(t,e,n,a,s)=>{const o=E(t,n,a,s);return e.mkdir(o,{recursive:!0})},Bt=(t,e,n)=>ft.map(a=>p(t,e,n,r.FOLDER_IMG,a)),Wt=(t,e,n)=>kt.map(a=>p(t,e,n,r.FOLDER_IMG,a)),$t=(t,e,n)=>[p(t,e,n,r.FOLDER_DATA,"")],Ut=t=>t===""?!0:!(t.endsWith("/")||xt(t)||jt(t)),Vt=["con","prn","aux","nul","com1","com2","com3","com4","com5","com6","com7","com8","com9","lpt1","lpt2","lpt3","lpt4","lpt5","lpt6","lpt7","lpt8","lpt9"],xt=t=>/[.#\\]/.test(t),jt=t=>t.split("/").some(n=>Vt.includes(n.toLowerCase())),Kt=async(t,e,n,a)=>{const s=E(t,n,r.FOLDER_IMG,a);return(await e.readdir(s,{withFileTypes:!0})).filter(b)},R=(t,e)=>t.name.endsWith(e),X=t=>R(t,".ogg")||R(t,".m4a"),Z=t=>R(t,".png"),b=t=>t.isFile()&&Z(t),tt=t=>t.isFile()&&X(t),Jt=async(t,e,n,a)=>{const s=E(t,n,r.FOLDER_AUDIO,a);return(await e.readdir(s,{withFileTypes:!0})).filter(tt)};exports.buildBattleback1Path=wt;exports.buildBattleback2Path=Pt;exports.buildBgmPath=St;exports.buildBgsPath=Ft;exports.buildCharactersImagePath=yt;exports.buildEnemyImagesPath=pt;exports.buildFaceImagesPath=Tt;exports.buildMePath=Ot;exports.buildParallacesPath=zt;exports.buildPicturesPath=ht;exports.buildSePath=Mt;exports.buildSideVewEnemiesPath=gt;exports.buildSideViewActorsPath=Ct;exports.buildSystemImagePath=vt;exports.buildTilesetImagesPath=Lt;exports.buildTitle1ImagesPath=Gt;exports.buildTitle2ImagesPath=Nt;exports.dispatchHandlers=Rt;exports.ensureActorDataPath=_;exports.ensureArmorDataPath=d;exports.ensureClassDataPath=A;exports.ensureCommonEventDataPath=w;exports.ensureEnemyDataPath=S;exports.ensureItemDataPath=F;exports.ensureMapInfoDataPath=P;exports.ensureSkillDataPath=O;exports.ensureStateDataPath=M;exports.ensureSystemDataPath=y;exports.ensureTroopDataPath=h;exports.ensureWeaponDataPath=T;exports.isAudioDirent=tt;exports.isAudioFileExtension=X;exports.isImageDirent=b;exports.isImageFileExtension=Z;exports.isMapFileName=Y;exports.isValidAssetPath=Ut;exports.listupAudioFiles=Jt;exports.listupImageFiles=Kt;exports.listupMapFiles=mt;exports.makeAudioFolders=Wt;exports.makeDataFoldes=$t;exports.makeImageFolders=Bt;exports.mappingAllMapFiles=lt;exports.readMapFileFromInfo=Q;exports.readRmmzActorData=C;exports.readRmmzArmorData=v;exports.readRmmzClassData=G;exports.readRmmzCommonEventData=J;exports.readRmmzEnemyData=k;exports.readRmmzItemData=B;exports.readRmmzMapInfoData=H;exports.readRmmzSkillData=$;exports.readRmmzStateData=V;exports.readRmmzSystemData=It;exports.readRmmzTroopData=K;exports.readRmmzWeaponData=j;exports.resolveMapFilePath=q;exports.writeDataFiles=_t;exports.writeRmmzActorData=z;exports.writeRmmzArmorData=g;exports.writeRmmzClassData=L;exports.writeRmmzCommonEventData=ot;exports.writeRmmzEnemyData=N;exports.writeRmmzItemData=f;exports.writeRmmzMapInfoData=it;exports.writeRmmzSkillData=W;exports.writeRmmzStateData=U;exports.writeRmmzSystemData=Et;exports.writeRmmzTroopData=rt;exports.writeRmmzWeaponData=x;
//# sourceMappingURL=rpgFolder.cjs.js.map
